Instalacao de Certificados (Bradesco)

instalar as CAs no trust store do sistema (RHEL) e usar a CA intermediaria para montar a cadeia do certificado do servidor (idbra.net.bradesco.com.br.crt).
Importante: NAO coloque o certificado do servidor (leaf) em anchors/ - esse diretorio e somente para Autoridades Certificadoras (CAs).

Arquivos na VM
- bradesco_root_CA_SHA2.cer (CA Raiz)
- bradesco_issuing_07_CA_SHA2.cer (CA Intermediaria)
- idbra.net.bradesco.com.br.crt (certificado do servidor / leaf)

================================================================================

1) Verificacoes rapidas do ambiente

rpm -q ca-certificates
command -v update-ca-trust >/dev/null

================================================================================

2) Habilitar o CA trust (idempotente)

sudo update-ca-trust enable

================================================================================

3) Instalar SOMENTE as CAs no trust do sistema

Os .cer estao em PEM; ao copiar, renomeie para .crt

sudo install -m 0644 bradesco_root_CA_SHA2.cer   /etc/pki/ca-trust/source/anchors/bradesco_root_CA_SHA2.crt

sudo install -m 0644 bradesco_issuing_07_CA_SHA2.cer   /etc/pki/ca-trust/source/anchors/bradesco_issuing_07_CA_SHA2.crt

================================================================================

4) Regenerar a base de CAs

sudo update-ca-trust extract

================================================================================

5) Conferir se entrou

trust list | grep -A3 -E "Bradesco|Issuing|07|SHA2"

Ate aqui, clientes nessa VM (curl, git etc.) passam a confiar na cadeia emissora Bradesco.

================================================================================

6) Usar a intermediaria no servidor HTTPS (fullchain)

Se ESTA VM for hospedar HTTPS para idbra.net.bradesco.com.br.

6.1) Colocar arquivos em locais padrao

sudo mkdir -p /etc/ssl/certs /etc/ssl/private
sudo chmod 700 /etc/ssl/private

6.2) Copiar o certificado do servidor (leaf) e a intermediaria

sudo install -m 0644 idbra.net.bradesco.com.br.crt   /etc/ssl/certs/idbra.net.bradesco.com.br.crt
sudo install -m 0644 bradesco_issuing_07_CA_SHA2.cer   /etc/ssl/certs/bradesco_issuing_07_CA_SHA2.crt

6.3) Montar a fullchain (ordem correta: servidor -> intermediaria). NAO inclua a raiz na fullchain do servidor.

sudo bash -c 'cat /etc/ssl/certs/idbra.net.bradesco.com.br.crt   /etc/ssl/certs/bradesco_issuing_07_CA_SHA2.crt   > /etc/ssl/certs/idbra_fullchain.crt'

6.4) Conferir os arquivos

ls -l /etc/ssl/certs/idbra* /etc/ssl/certs/bradesco_issuing_07_CA_SHA2.crt

================================================================================

7) Testes uteis

7.1) Como cliente (apos instalar as CAs)

curl -vI https://idbra.net.bradesco.com.br

7.2) Handshake TLS do servidor (testando localmente)

# opcional: mapear hostname para 127.0.0.1 p/ teste local
# echo "127.0.0.1 idbra.net.bradesco.com.br" | sudo tee -a /etc/hosts

openssl s_client -connect 127.0.0.1:443 -servername idbra.net.bradesco.com.br -showcerts </dev/null | openssl x509 -noout -subject -issuer

================================================================================

OBS:

- NAO copiar idbra.net.bradesco.com.br.crt para anchors/ (anchors e so para CAs).
- Se algo der errado, remover e regenarar:

sudo rm -f /etc/pki/ca-trust/source/anchors/bradesco_root_CA_SHA2.crt
sudo rm -f /etc/pki/ca-trust/source/anchors/bradesco_issuing_07_CA_SHA2.crt
sudo update-ca-trust extract

- Se usar Java que nao herda o trust do sistema, importe as CAs no cacerts com keytool.

